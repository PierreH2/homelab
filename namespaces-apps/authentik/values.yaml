# Authentik Helm Chart Values

# 1. Component-specific Configuration
server:
  replicas: 2
  # FIX: Service config must be inside the server block
  service:
    type: ClusterIP
    servicePortHttp: 80
  
  # Gateway API Configuration
  route:
    main:
      enabled: true
      hostnames:
        - "authentik.piron-tech.com"
      parentRefs:
        - name: my-gateway # Verify this name matches your Gateway resource
          namespace: gateway-system

worker:
  replicas: 1

# 2. Global Environment Variables (Mapping your existing secrets)
global:
  env:
    # Map the Authentik Secret Key
    - name: AUTHENTIK_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authentik-secrets
          key: secret-key
    # Map Database Password
    - name: AUTHENTIK_POSTGRESQL__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-postgresql
          key: password
    # Map Redis Password
    - name: AUTHENTIK_REDIS__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-redis
          key: password

# 3. Authentik Core Config
authentik:
  external_host: https://authentik.piron-tech.com
  error_reporting:
    enabled: false
  postgresql:
    host: "authentik-postgresql" # The service name for your DB
    user: "authentik"
    name: "authentik"
  
# 4. Disable Built-in DB/Redis (Since you provide your own via secrets/pre-existing pods)
postgresql:
  enabled: false
redis:
  enabled: false

# 5. Bootstrap config
disableBootstrapUser: true